<ng-container *ngIf="package$ | async as package; else loading">
  <div class="esign-layout">
    <aside class="left-sidebar">
      <mat-form-field appearance="outline" class="signer-select">
        <mat-label>Selected Signer</mat-label>
        <mat-select [value]="selectedSigner" (selectionChange)="selectedSigner = $event.value">
          <mat-option *ngFor="let s of package.signers" [value]="s">{{ s.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="fields-section">
        <div class="section-title">Fields</div>
        <div class="field-list">
          <button type="button" class="field-item" *ngFor="let field of (fields$ | async)" draggable="true"
            (dragstart)="addFieldDragStart($event, field)">
            <mat-icon class="field-icon">drag_indicator</mat-icon>
            <span class="field-label">{{ field.name }}</span>
          </button>
        </div>
      </div>
    </aside>

    <main class="center-canvas" #documentContainer>
      <div class="document" *ngFor="let document of package.documents">
        <div class="pages">
          <div class="page" *ngFor="let page of document.pages; let pageIndex = index">
            <img [src]="page.pageURL" (load)="imageLoad()" />
            <div class="overlay-div" [id]="'d' + document.documentId + 'p' + page.pageNumber"
              [attr.page-height]="page.height" [attr.page-width]="page.width" #parent (dragenter)="dragEnter($event)"
              (dragover)="dragover($event)" (drop)="itemDropped($event, document, page, selectedSigner)">
            </div>
            <div class="page-title">
              <div>Page {{ pageIndex + 1 }}</div>
              <div>{{ document.name }}</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <aside class="right-thumbnails">
      <document-thumbnails [documents]="package.documents" (select)="scrollTo($event)"></document-thumbnails>
    </aside>
  </div>
</ng-container>

<ng-template #loading>
  <div class="loading-overlay">
    <div class="loading-container">
      <mat-spinner diameter="60"></mat-spinner>
      <p>Loading...</p>
    </div>
  </div>
</ng-template>